<div class="max-w-4xl mx-auto py-6 sm:px-6 lg:px-8">
  <div class="px-4 py-6 sm:px-0">
    <div class="flex justify-between items-center mb-6">
      <div>
        <h1 class="text-3xl font-bold text-gray-900">E2B Report Generator</h1>
        <p class="mt-2 text-gray-600">Create new Individual Case Safety Reports (ICSR)</p>
      </div>
      <button 
        (click)="navigateToReports()"
        class="btn btn-secondary"
      >
        View My Reports
      </button>
    </div>

    <div class="bg-white shadow rounded-lg">
      <div class="px-4 py-5 sm:p-6">
        <form [formGroup]="reportForm" (ngSubmit)="onSubmit()">
          
          <!-- Basic Information -->
          <div class="mb-8">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Basic Information</h3>
            <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
              <div>
                <label class="form-label">Report Title *</label>
                <input type="text" formControlName="title" class="form-input">
                <div *ngIf="reportForm.get('title')?.touched && reportForm.get('title')?.errors?.['required']" class="text-red-500 text-sm mt-1">
                  Report title is required
                </div>
              </div>
              <div>
                <label class="form-label">Primary Source Country *</label>
                <select formControlName="primarySourceCountry" class="form-input">
                  <option value="US">United States</option>
                  <option value="CA">Canada</option>
                  <option value="GB">United Kingdom</option>
                  <option value="DE">Germany</option>
                  <option value="FR">France</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Reporter Information -->
          <div class="mb-8">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Reporter Information</h3>
            <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
              <div>
                <label class="form-label">Title *</label>
                <select formControlName="reporterTitle" class="form-input">
                  <option value="Dr.">Dr.</option>
                  <option value="Mr.">Mr.</option>
                  <option value="Ms.">Ms.</option>
                  <option value="Mrs.">Mrs.</option>
                </select>
              </div>
              <div>
                <label class="form-label">First Name *</label>
                <input type="text" formControlName="reporterGiveName" class="form-input">
              </div>
              <div>
                <label class="form-label">Last Name *</label>
                <input type="text" formControlName="reporterFamilyName" class="form-input">
              </div>
              <div>
                <label class="form-label">Organization *</label>
                <input type="text" formControlName="reporterOrganization" class="form-input">
              </div>
              <div>
                <label class="form-label">Street Address *</label>
                <input type="text" formControlName="reporterStreet" class="form-input">
              </div>
              <div>
                <label class="form-label">City *</label>
                <input type="text" formControlName="reporterCity" class="form-input">
              </div>
              <div>
                <label class="form-label">State/Province *</label>
                <input type="text" formControlName="reporterState" class="form-input">
              </div>
              <div>
                <label class="form-label">Postal Code *</label>
                <input type="text" formControlName="reporterPostcode" class="form-input">
              </div>
              <div>
                <label class="form-label">Country *</label>
                <select formControlName="reporterCountry" class="form-input">
                  <option value="US">United States</option>
                  <option value="CA">Canada</option>
                  <option value="GB">United Kingdom</option>
                  <option value="DE">Germany</option>
                  <option value="FR">France</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Patient Information -->
          <div class="mb-8">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Patient Information</h3>
            <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
              <div>
                <label class="form-label">Patient Initials *</label>
                <input type="text" formControlName="patientInitial" class="form-input" placeholder="J.D.">
              </div>
              <div>
                <label class="form-label">Birth Date *</label>
                <input type="date" formControlName="patientBirthdate" class="form-input">
              </div>
              <div>
                <label class="form-label">Age *</label>
                <input type="number" formControlName="patientAge" class="form-input" min="0" max="120">
              </div>
              <div>
                <label class="form-label">Sex *</label>
                <select formControlName="patientSex" class="form-input">
                  <option value="1">Male</option>
                  <option value="2">Female</option>
                  <option value="0">Unknown</option>
                </select>
              </div>
              <div>
                <label class="form-label">Weight (kg)</label>
                <input type="number" formControlName="patientWeight" class="form-input" min="0" max="500">
              </div>
              <div>
                <label class="form-label">Height (cm)</label>
                <input type="number" formControlName="patientHeight" class="form-input" min="0" max="300">
              </div>
            </div>
          </div>

          <!-- Reaction Information -->
          <div class="mb-8">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Adverse Reaction Information</h3>
            <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
              <div class="sm:col-span-2">
                <label class="form-label">Primary Source Reaction *</label>
                <textarea formControlName="primarySourceReaction" class="form-input" rows="3" placeholder="Describe the adverse reaction"></textarea>
              </div>
              <div>
                <label class="form-label">Reaction Start Date *</label>
                <input type="date" formControlName="reactionStartDate" class="form-input">
              </div>
              <div>
                <label class="form-label">Reaction End Date</label>
                <input type="date" formControlName="reactionEndDate" class="form-input">
              </div>
              <div>
                <label class="form-label">Duration (days)</label>
                <input type="number" formControlName="reactionDuration" class="form-input" min="0">
              </div>
              <div>
                <label class="form-label">Outcome *</label>
                <select formControlName="reactionOutcome" class="form-input">
                  <option value="1">Recovered/Resolved</option>
                  <option value="2">Recovering/Resolving</option>
                  <option value="3">Not recovered/Not resolved</option>
                  <option value="4">Fatal</option>
                  <option value="5">Unknown</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Drug Information -->
          <div class="mb-8">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Drug Information</h3>
            <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
              <div>
                <label class="form-label">Medicinal Product *</label>
                <input type="text" formControlName="medicinalProduct" class="form-input" placeholder="Drug name">
              </div>
              <div>
                <label class="form-label">Batch Number</label>
                <input type="text" formControlName="drugBatchNumb" class="form-input">
              </div>
              <div>
                <label class="form-label">Authorization Number</label>
                <input type="text" formControlName="drugAuthorizationNumb" class="form-input">
              </div>
              <div>
                <label class="form-label">Dosage *</label>
                <input type="text" formControlName="drugDosageText" class="form-input" placeholder="e.g., 10mg daily">
              </div>
              <div>
                <label class="form-label">Dosage Form</label>
                <input type="text" formControlName="drugDosageForm" class="form-input" placeholder="e.g., Tablet, Capsule">
              </div>
              <div>
                <label class="form-label">Route of Administration</label>
                <select formControlName="drugAdministrationRoute" class="form-input">
                  <option value="065">Oral</option>
                  <option value="047">Intravenous</option>
                  <option value="058">Intramuscular</option>
                  <option value="063">Subcutaneous</option>
                  <option value="034">Topical</option>
                </select>
              </div>
              <div>
                <label class="form-label">Indication</label>
                <input type="text" formControlName="drugIndication" class="form-input" placeholder="Reason for use">
              </div>
              <div>
                <label class="form-label">Drug Start Date *</label>
                <input type="date" formControlName="drugStartDate" class="form-input">
              </div>
              <div>
                <label class="form-label">Drug End Date</label>
                <input type="date" formControlName="drugEndDate" class="form-input">
              </div>
            </div>
          </div>

          <!-- Seriousness Criteria -->
          <div class="mb-8">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Seriousness Criteria</h3>
            <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
              <div>
                <label class="form-label">Death</label>
                <select formControlName="seriousnessDeath" class="form-input">
                  <option value="2">No</option>
                  <option value="1">Yes</option>
                </select>
              </div>
              <div>
                <label class="form-label">Life Threatening</label>
                <select formControlName="seriousnessLifeThreatening" class="form-input">
                  <option value="2">No</option>
                  <option value="1">Yes</option>
                </select>
              </div>
              <div>
                <label class="form-label">Hospitalization</label>
                <select formControlName="seriousnessHospitalization" class="form-input">
                  <option value="2">No</option>
                  <option value="1">Yes</option>
                </select>
              </div>
              <div>
                <label class="form-label">Disabling</label>
                <select formControlName="seriousnessDisabling" class="form-input">
                  <option value="2">No</option>
                  <option value="1">Yes</option>
                </select>
              </div>
              <div>
                <label class="form-label">Congenital Anomaly</label>
                <select formControlName="seriousnessCongenitalAnomali" class="form-input">
                  <option value="2">No</option>
                  <option value="1">Yes</option>
                </select>
              </div>
              <div>
                <label class="form-label">Other Serious</label>
                <select formControlName="seriousnessOther" class="form-input">
                  <option value="2">No</option>
                  <option value="1">Yes</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Debug Info -->
          <div class="mb-6 p-4 bg-gray-100 rounded">
            <h4 class="font-medium text-gray-900 mb-2">Form Status:</h4>
            <p class="text-sm text-gray-600">Form Valid: {{ reportForm.valid }}</p>
            <p class="text-sm text-gray-600">Button Disabled: {{ !reportForm.valid || isLoading }}</p>
            
            <div class="mt-3">
              <h5 class="text-sm font-medium text-gray-900 mb-1">Required Fields Status:</h5>
              <div class="grid grid-cols-2 gap-2 text-xs">
                <div [class]="reportForm.get('title')?.valid ? 'text-green-600' : 'text-red-600'">
                  • Report Title: {{ reportForm.get('title')?.valid ? 'Valid' : 'Required' }}
                </div>
                <div [class]="reportForm.get('reporterGiveName')?.valid ? 'text-green-600' : 'text-red-600'">
                  • Reporter First Name: {{ reportForm.get('reporterGiveName')?.valid ? 'Valid' : 'Required' }}
                </div>
                <div [class]="reportForm.get('reporterFamilyName')?.valid ? 'text-green-600' : 'text-red-600'">
                  • Reporter Last Name: {{ reportForm.get('reporterFamilyName')?.valid ? 'Valid' : 'Required' }}
                </div>
                <div [class]="reportForm.get('reporterOrganization')?.valid ? 'text-green-600' : 'text-red-600'">
                  • Reporter Organization: {{ reportForm.get('reporterOrganization')?.valid ? 'Valid' : 'Required' }}
                </div>
                <div [class]="reportForm.get('reporterStreet')?.valid ? 'text-green-600' : 'text-red-600'">
                  • Reporter Street: {{ reportForm.get('reporterStreet')?.valid ? 'Valid' : 'Required' }}
                </div>
                <div [class]="reportForm.get('reporterCity')?.valid ? 'text-green-600' : 'text-red-600'">
                  • Reporter City: {{ reportForm.get('reporterCity')?.valid ? 'Valid' : 'Required' }}
                </div>
                <div [class]="reportForm.get('reporterState')?.valid ? 'text-green-600' : 'text-red-600'">
                  • Reporter State: {{ reportForm.get('reporterState')?.valid ? 'Valid' : 'Required' }}
                </div>
                <div [class]="reportForm.get('reporterPostcode')?.valid ? 'text-green-600' : 'text-red-600'">
                  • Reporter Postal Code: {{ reportForm.get('reporterPostcode')?.valid ? 'Valid' : 'Required' }}
                </div>
                <div [class]="reportForm.get('patientInitial')?.valid ? 'text-green-600' : 'text-red-600'">
                  • Patient Initials: {{ reportForm.get('patientInitial')?.valid ? 'Valid' : 'Required' }}
                </div>
                <div [class]="reportForm.get('patientBirthdate')?.valid ? 'text-green-600' : 'text-red-600'">
                  • Patient Birth Date: {{ reportForm.get('patientBirthdate')?.valid ? 'Valid' : 'Required' }}
                </div>
                <div [class]="reportForm.get('patientAge')?.valid ? 'text-green-600' : 'text-red-600'">
                  • Patient Age: {{ reportForm.get('patientAge')?.valid ? 'Valid' : 'Required' }}
                </div>
                <div [class]="reportForm.get('primarySourceReaction')?.valid ? 'text-green-600' : 'text-red-600'">
                  • Primary Reaction: {{ reportForm.get('primarySourceReaction')?.valid ? 'Valid' : 'Required' }}
                </div>
                <div [class]="reportForm.get('reactionStartDate')?.valid ? 'text-green-600' : 'text-red-600'">
                  • Reaction Start Date: {{ reportForm.get('reactionStartDate')?.valid ? 'Valid' : 'Required' }}
                </div>
                <div [class]="reportForm.get('medicinalProduct')?.valid ? 'text-green-600' : 'text-red-600'">
                  • Medicinal Product: {{ reportForm.get('medicinalProduct')?.valid ? 'Valid' : 'Required' }}
                </div>
                <div [class]="reportForm.get('drugDosageText')?.valid ? 'text-green-600' : 'text-red-600'">
                  • Drug Dosage: {{ reportForm.get('drugDosageText')?.valid ? 'Valid' : 'Required' }}
                </div>
                <div [class]="reportForm.get('drugStartDate')?.valid ? 'text-green-600' : 'text-red-600'">
                  • Drug Start Date: {{ reportForm.get('drugStartDate')?.valid ? 'Valid' : 'Required' }}
                </div>
              </div>
            </div>

            <button 
              type="button" 
              (click)="fillSampleData()" 
              class="mt-3 px-3 py-1 bg-purple-500 text-white rounded text-sm hover:bg-purple-600"
            >
              Fill Sample Data (for testing)
            </button>
          </div>

          <!-- Messages -->
          <div class="mb-6">
            <div class="text-red-600 text-sm" *ngIf="error">
              {{ error }}
            </div>
            <div class="text-green-600 text-sm" *ngIf="success">
              {{ success }}
            </div>
          </div>

          <!-- Submit Button -->
          <div class="flex justify-end space-x-4">
            <button
              type="button"
              (click)="onSubmit()"
              class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700"
            >
              <span *ngIf="isLoading">Creating Report...</span>
              <span *ngIf="!isLoading">Force Submit (Debug)</span>
            </button>
            <button
              type="submit"
              [disabled]="!reportForm.valid || isLoading"
              class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <span *ngIf="isLoading">Creating Report...</span>
              <span *ngIf="!isLoading">Create E2B Report</span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>